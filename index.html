<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NJ936 æ™ºèƒ½è°ƒåº¦å° V3.2 (ä¿®å¤ç‰ˆ)</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; --border: #e2e8f0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 0; height: 100vh; overflow: hidden; }
        
        .main-container { display: grid; grid-template-columns: 28% 42% 30%; height: 100vh; }
        
        .column { padding: 15px; overflow-y: auto; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .column h2 { font-size: 1.1em; color: #334155; margin-top: 0; border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 15px; }
        
        /* å·¦ä¾§ */
        .col-left { background: #fff; }
        textarea.raw-input { width: 100%; flex: 1; border: 1px solid #cbd5e1; border-radius: 6px; padding: 10px; font-family: monospace; font-size: 0.85em; resize: none; box-sizing: border-box; white-space: pre; overflow-x: auto; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 10px; }
        .btn-parse { background: var(--primary); color: white; border: none; padding: 10px; flex: 1; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-clear { background: #cbd5e1; color: #334155; border: none; padding: 10px; border-radius: 6px; cursor: pointer; width: 60px;}
        .btn-parse:hover { background: #1d4ed8; }

        /* ä¸­é—´ */
        .col-center { background: #f1f5f9; }
        .section-card { background: #fff; border-radius: 8px; padding: 12px; margin-bottom: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); border-left: 5px solid #ccc; }
        .section-card h3 { margin: 0 0 8px 0; font-size: 1em; color: #475569; }
        
        .s1 { border-left-color: #ef4444; } .s2 { border-left-color: #f59e0b; } 
        .s3 { border-left-color: #10b981; } .s4 { border-left-color: #8b5cf6; } .s5 { border-left-color: #ec4899; }

        .queue-item { display: flex; align-items: flex-start; background: #fff; border: 1px solid #e2e8f0; margin-bottom: 5px; padding: 6px; border-radius: 4px; }
        .status-btn { cursor: pointer; font-size: 1.2em; margin-right: 8px; user-select: none; width: 25px; text-align: center; line-height: 1.2; }
        .item-content { flex: 1; display: flex; flex-direction: column; gap: 2px; }
        .item-text { font-family: monospace; font-size: 0.9em; outline: none; border-bottom: 1px dashed transparent; width: 100%; word-break: break-all; }
        .item-text:focus { border-bottom: 1px dashed #94a3b8; background: #fffbeb; }
        .del-btn { color: #cbd5e1; cursor: pointer; margin-left: 5px; font-size: 0.9em; }
        .del-btn:hover { color: #ef4444; }

        /* æ‰‹åŠ¨æ·»åŠ å°éƒ¨ä»¶ */
        .manual-box { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px dashed #e2e8f0; }
        .manual-box button { padding: 2px 6px; font-size: 0.8em; cursor: pointer; border: 1px solid #cbd5e1; background: white; border-radius: 3px; }
        .manual-box button.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        .manual-box input { width: 50px; padding: 2px; font-size: 0.8em; border: 1px solid #cbd5e1; border-radius: 3px; }
        .btn-add-mini { background: #10b981 !important; color: white !important; border: none !important; font-weight: bold; }

        /* å³ä¾§ */
        .col-right { background: #fff; }
        textarea.final-output { width: 100%; height: 100%; border: none; resize: none; outline: none; font-family: monospace; font-size: 0.9em; line-height: 1.4; }
        .btn-copy { position: absolute; bottom: 20px; right: 20px; background: #334155; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<div class="main-container">
    
    <div class="column col-left">
        <h2>ğŸ“‚ 1. æ•°æ®æ¥æº (æ··åˆæ¨¡å¼)</h2>
        <div class="btn-group">
            <button class="btn-parse" onclick="parseInput()">âš¡ æ‰§è¡Œæ™ºèƒ½è§£æ</button>
            <button class="btn-clear" onclick="clearAll()">æ¸…ç©º</button>
        </div>
        <textarea id="rawInput" class="raw-input" placeholder="è¯·ç²˜è´´æ•°æ®ï¼š
1. Excel æ•´è¡Œæ•°æ® (UNI73925...)
2. æˆ–è€…ä¹‹å‰çš„æ—¥æŠ¥ (ğŸš—1ã€NJ936...)"></textarea>
    </div>

    <div class="column col-center">
        <h2>ğŸ› ï¸ 2. è°ƒåº¦æ§åˆ¶å°</h2>

        <div class="section-card s1">
            <h3>ğŸŒŸ 80så¤§åŒº</h3>
            <div class="manual-box">
                <div id="btns-s1">
                    <button onclick="setDest('s1','ORD')">ORD</button>
                    <button onclick="setDest('s1','DFW')">DFW</button>
                    <button onclick="setDest('s1','CMH-CVG-SDF')">Mix</button>
                </div>
                <input id="in-s1-p" placeholder="æ¿æ•°"><input id="in-s1-u" placeholder="UNI">
                <button class="btn-add-mini" onclick="manualAdd('s1')">ï¼‹</button>
            </div>
            <div id="list-s1"></div>
        </div>

        <div class="section-card s2">
            <h3>ğŸŒŸ 80så«æ˜Ÿä»“</h3>
            <div class="manual-box">
                <div id="btns-s2">
                    <button onclick="setDest('s2','DCA')">DCA</button>
                    <button onclick="setDest('s2','PHL')">PHL</button>
                    <button onclick="setDest('s2','BOS')">BOS</button>
                    <button onclick="setDest('s2','PIT')">PIT</button>
                </div>
                <input id="in-s2-p" placeholder="æ¿"><input id="in-s2-u" placeholder="UNI">
                <button class="btn-add-mini" onclick="manualAdd('s2')">ï¼‹</button>
            </div>
            <div id="list-s2"></div>
        </div>

        <div class="section-card s3">
            <h3>ğŸŒŸ Han Express</h3>
            <div class="manual-box">
                <div id="btns-s3">
                    <button onclick="setDest('s3','JFK')">JFK</button>
                    <button onclick="setDest('s3','600')">600</button>
                </div>
                <input id="in-s3-p" placeholder="æ¿æ•°">
                <button class="btn-add-mini" onclick="manualAdd('s3')">ï¼‹</button>
            </div>
            <div id="list-s3"></div>
        </div>

        <div class="section-card s4">
            <h3>ğŸŒŸ NYQZ</h3>
            <div class="manual-box">
                <div id="btns-s4">
                    <button onclick="setDest('s4','ATL')">ATL</button>
                    <button onclick="setDest('s4','MIA')">MIA</button>
                </div>
                <input id="in-s4-p" placeholder="æ¿"><input id="in-s4-u" placeholder="UNI">
                <button class="btn-add-mini" onclick="manualAdd('s4')">ï¼‹</button>
            </div>
            <div id="list-s4"></div>
        </div>

        <div class="section-card s5">
            <h3>ğŸŒŸ è¿åŠ›éƒ¨</h3>
            <div class="manual-box">
                L:<input type="number" id="in-s5-lax" value="0" style="width:25px">
                S:<input type="number" id="in-s5-sea" value="0" style="width:25px">
                J:<input type="number" id="in-s5-sjc" value="0" style="width:25px">
                <input id="in-s5-u" placeholder="UNI" style="width:50px">
                <div id="btns-s5">
                   <button onclick="setCarrier('Millennium')">Mill</button>
                   <button onclick="setCarrier('Spot Freight')">Spot</button>
                </div>
                <button class="btn-add-mini" onclick="manualAdd('s5')">ï¼‹</button>
            </div>
            <div id="list-s5"></div>
        </div>
    </div>

    <div class="column col-right">
        <h2>ğŸ“ 3. æœ€ç»ˆæ—¥æŠ¥</h2>
        <textarea id="finalOutput" class="final-output" readonly></textarea>
        <button class="btn-copy" onclick="copyFinal()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
    </div>
</div>

<script>
    const STATE_ICONS = ['ğŸŒ', 'ğŸš—', 'âŒ'];
    let appData = { s1:[], s2:[], s3:[], s4:[], s5:[] };
    let selection = { s1:'', s2:'', s3:'', s4:'', s5Carrier:'' };
    let todayStr = new Date().toISOString().split('T')[0];

    // --- å¢å¼ºç‰ˆè§£æå™¨ ---
    function parseInput() {
        const rawText = document.getElementById('rawInput').value;
        const lines = rawText.split('\n');
        
        // é‡ç½®
        appData = { s1:[], s2:[], s3:[], s4:[], s5:[] };
        
        let currentSection = null; // ç”¨äºè¿½è¸ªæ—¥æŠ¥æ¨¡å¼ä¸‹çš„å½“å‰æ¿å—
        
        lines.forEach(line => {
            line = line.trim();
            if (!line) return;

            // --- 1. æ—¥æŠ¥æ ‡é¢˜è¯†åˆ« ---
            if (line.includes('ã€NJ936-80så¤§åŒº')) { currentSection = 's1'; return; }
            if (line.includes('ã€NJ936-80så«æ˜Ÿ')) { currentSection = 's2'; return; }
            if (line.includes('ã€NJ936-Han')) { currentSection = 's3'; return; }
            if (line.includes('ã€NJ936 NYQZ')) { currentSection = 's4'; return; }
            if (line.includes('ã€NJ936 è¿åŠ›éƒ¨')) { currentSection = 's5'; return; }

            // --- 2. æ—¥æŠ¥å†…å®¹è¡Œè¯†åˆ« (ä¿®å¤äº†æ­£åˆ™ï¼Œæ›´å®½å®¹) ---
            // åŒ¹é…: (å¯é€‰Emoji) (ç©ºæ ¼) (æ•°å­—) (å¯é€‰+æ•°å­—) (åˆ†éš”ç¬¦ã€.,) (å†…å®¹)
            const reportMatch = line.match(/^([ğŸš—ğŸŒâŒ])?\s*(\d+(?:\+\d+)?)\s*[ã€\.,]\s*(.*)/);

            if (currentSection && reportMatch) {
                // è¿™æ˜¯ä¸€ä¸ªå›è´´çš„æ—¥æŠ¥è¡Œ
                let icon = reportMatch[1];
                let numPart = reportMatch[2];
                let content = reportMatch[3];
                
                let status = 0; // é»˜è®¤ ğŸŒ
                if (icon === 'ğŸš—') status = 1;
                if (icon === 'âŒ') status = 2;

                let isDouble = numPart.includes('+'); 
                
                appData[currentSection].push({ text: content, status: status, isDouble: isDouble });
                return; // å¤„ç†å®Œæ—¥æŠ¥è¡Œï¼Œè·³è¿‡åç»­ Excel æ£€æµ‹
            }

            // --- 3. Excel åŸå§‹æ•°æ®è¯†åˆ« (å¢å¼ºç‰ˆ) ---
            // åªè¦æ˜¯ä»¥ UNI å¼€å¤´ï¼Œå°±è®¤ä¸ºæ˜¯ Excel æ•°æ®ï¼Œä¸ç®¡ç”¨ Tab è¿˜æ˜¯ç©ºæ ¼åˆ†éš”
            if (line.toUpperCase().startsWith('UNI')) {
                // ä½¿ç”¨ Tab æˆ– 2ä¸ªä»¥ä¸Šç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦
                const parts = line.split(/\t+|\s{2,}/);
                
                // ç¡®ä¿è‡³å°‘æœ‰ 5 åˆ—æ•°æ® (UNI, Carrier, Origin, Dest, Plates)
                if (parts.length >= 5) {
                    const uni = parts[0].trim();
                    const carrier = parts[1].trim();
                    const rawDest = parts[3].trim(); // è¿™æ˜¯ä¸€ä¸ªåŒ…å«åœ°å€çš„é•¿å­—ç¬¦ä¸²
                    const plates = parts[4].trim();

                    // æå–ç›®çš„åœ°ä»£ç  (å¯»æ‰¾ *CODE* æˆ–è€… CODE + æ•°å­—)
                    // é€»è¾‘ï¼šåŒ¹é…3ä¸ªå¤§å†™å­—æ¯ç´§æ¥æ•°å­—
                    let destCode = "";
                    const destMatch = rawDest.match(/(\*?)([A-Z]{3})\d+/);
                    if (destMatch) {
                        destCode = destMatch[2]; // å–å‡º BOS, LAX, MIA ç­‰
                    } else if (rawDest.includes("600 Federal")) {
                        destCode = "600";
                    }

                    // è·¯ç”±åˆ†æ‹£é€»è¾‘
                    if (carrier.includes("Han Express")) {
                        // Han ç‰¹æ®Šé€»è¾‘: å¦‚æœæ²¡è¯†åˆ«å‡ºJFK/600ï¼Œé»˜è®¤æ£€æŸ¥æ˜¯å¦æ˜¯12æ¿ä»¥ä¸Š
                        let dCode = destCode === "600" ? "600" : "JFK"; // é»˜è®¤ä¸ºJFKå¦‚æœæ²¡åŒ¹é…åˆ°600
                        if(rawDest.includes("600")) dCode = "600";
                        addToData('s3', `EWR936-${dCode} (${plates}æ¿) 20:00å‘`, false, plates);
                    } 
                    else if (carrier.includes("NYQZ")) {
                        addToData('s4', `NJ936-${destCode}(${plates}æ¿) 20:00PMå‘ - ${uni}`);
                    } 
                    else if (carrier.includes("Spot") || carrier.includes("Millennium")) {
                        const cName = carrier.includes("Spot") ? "Spot Freight" : "Millennium Transport";
                        // è¿åŠ›éƒ¨æš‚ä¸è‡ªåŠ¨æ‹†åˆ†LAX/SEAï¼Œåªæ˜¾ç¤ºæ€»æ•°ï¼Œç”±äººå·¥åœ¨ä¸­é—´ä¿®æ”¹
                        addToData('s5', `NJ936-LAX(${plates}æ¿) 12:00å‘ - ${uni}(${cName})`);
                    } 
                    else if (carrier.includes("80s")) {
                        const sats = ['DCA', 'PHL', 'BOS', 'PIT'];
                        if (sats.includes(destCode)) {
                            addToData('s2', `EWR936-${destCode} (${plates}æ¿) 21:00å‘ ${uni}`);
                        } else {
                            // é»˜è®¤å½’ä¸ºå¤§åŒº (ORD, DFW, IAH, CMH...)
                            addToData('s1', `NJ936-${destCode} (${plates}æ¿) 16:30pmå‘ - ${uni}`);
                        }
                    }
                }
            }
        });

        renderAll();
    }

    function addToData(sec, text, isDoubleOverride = false, plateStr="0") {
        let isDouble = isDoubleOverride;
        // Han Express è‡ªåŠ¨åˆ¤æ–­åŒå·
        if(sec === 's3' && (parseInt(plateStr.match(/\d+/))||0) > 12) isDouble = true;
        appData[sec].push({ text: text, status: 0, isDouble: isDouble });
    }

    // --- æ¸²æŸ“ä¸äº¤äº’ ---
    function renderAll() {
        ['s1','s2','s3','s4','s5'].forEach(sec => {
            const el = document.getElementById(`list-${sec}`);
            el.innerHTML = '';
            appData[sec].forEach((item, i) => {
                const row = document.createElement('div');
                row.className = 'queue-item';
                
                row.innerHTML = `
                    <div class="status-btn" onclick="toggleStatus('${sec}', ${i})">${STATE_ICONS[item.status]}</div>
                    <div class="item-content">
                        <div class="item-text" contenteditable="true" oninput="updateText('${sec}', ${i}, this)">${item.text}</div>
                    </div>
                    <div class="del-btn" onclick="delItem('${sec}', ${i})">âŒ</div>
                `;
                el.appendChild(row);
            });
        });
        generateFinal();
    }

    function toggleStatus(sec, i) {
        appData[sec][i].status = (appData[sec][i].status + 1) % 3;
        renderAll();
    }
    
    function updateText(sec, i, el) {
        appData[sec][i].text = el.innerText;
        generateFinal(); 
    }

    function delItem(sec, i) {
        appData[sec].splice(i, 1);
        renderAll();
    }

    function clearAll() {
        document.getElementById('rawInput').value = '';
        appData = { s1:[], s2:[], s3:[], s4:[], s5:[] };
        renderAll();
    }

    // --- æ‰‹åŠ¨æ·»åŠ é€»è¾‘ ---
    function setDest(sec, v) { 
        selection[sec] = v;
        document.querySelectorAll(`#btns-${sec} button`).forEach(b => b.classList.toggle('active', b.innerText === v || (v.length>5 && b.innerText==='Mix')));
    }
    function setCarrier(v) { 
        selection.s5Carrier = v;
        document.querySelectorAll(`#btns-s5 button`).forEach(b => b.classList.toggle('active', v.startsWith(b.innerText)));
    }

    function manualAdd(sec) {
        const time = sec==='s1'||sec==='s5'?'16:30pm':'20:00';
        let txt = "", dbl = false;
        const p = document.getElementById(`in-${sec}-p`)?.value || "";
        const uRaw = document.getElementById(`in-${sec}-u`)?.value || "";
        const u = uRaw ? (uRaw.toUpperCase().startsWith('UNI')?uRaw:'UNI'+uRaw) : "";

        if(sec === 's1') {
            if(!selection.s1) return alert('è¯·é€‰æ‹©ç›®çš„åœ°');
            txt = `NJ936-${selection.s1} (${p}æ¿) ${time}å‘ - ${u}`;
        } else if(sec === 's2') {
            txt = `EWR936-${selection.s2} (${p}æ¿) ${time}å‘ ${u}`;
        } else if(sec === 's3') {
            txt = `EWR936-${selection.s3} (${p}æ¿) ${time}å‘`;
            if((parseInt(p)||0) > 12) dbl = true;
        } else if(sec === 's4') {
            txt = `NJ936-${selection.s4}(${p}æ¿) ${time}PMå‘ - ${u}`;
        } else if(sec === 's5') {
            const l=document.getElementById('in-s5-lax').value, s=document.getElementById('in-s5-sea').value, j=document.getElementById('in-s5-sjc').value;
            let stops = [];
            if(l>0) stops.push(l+'*LAX'); if(s>0) stops.push(s+'*SEA'); if(j>0) stops.push(j+'*SJC');
            txt = `NJ936-LAX(${stops.join(', ') || p+'æ¿'}) ${time}å‘ - ${u}(${selection.s5Carrier})`;
        }
        
        appData[sec].push({ text: txt, status: 0, isDouble: dbl });
        renderAll();
    }

    // --- ç”Ÿæˆæ—¥æŠ¥ ---
    function generateFinal() {
        let res = `${todayStr}\n`;
        const heads = {
            s1: "ğŸŒŸã€NJ936-80så¤§åŒºè½¬è¿ã€‘--éœ€è¦è¡¥å……æ¯ä¸€ä¸ªè½¦çš„BOLå·ç ",
            s2: "ğŸŒŸã€NJ936-80så«æ˜Ÿä»“è½¬è¿ã€‘",
            s3: "ğŸŒŸã€NJ936-Han Express JFK+600è½¬è¿ã€‘",
            s4: "ğŸŒŸã€NJ936 NYQZã€‘--éœ€è¦è¡¥å……æ¯ä¸€ä¸ªè½¦çš„BOLå·ç ",
            s5: "ğŸŒŸã€NJ936 è¿åŠ›éƒ¨å«è½¦ã€‘--éœ€è¦è¡¥å……æ¯ä¸€ä¸ªè½¦çš„BOLå·ç "
        };

        ['s1','s2','s3','s4','s5'].forEach(k => {
            res += `\n${heads[k]}\n`;
            let c = 1;
            appData[k].forEach(item => {
                if(item.status === 2) return; 
                let idx = item.isDouble ? `${c}+${c+1}` : `${c}`;
                c += item.isDouble ? 2 : 1;
                let sep = (k==='s2'||k==='s3') ? '. ' : 'ã€';
                res += `${STATE_ICONS[item.status]}${idx}${sep}${item.text}\n`;
            });
        });
        document.getElementById('finalOutput').value = res;
    }

    function copyFinal() {
        document.getElementById('finalOutput').select();
        document.execCommand('copy');
        alert("å·²å¤åˆ¶ï¼");
    }
    
    // åˆå§‹åŒ–è¿è¡Œä¸€æ¬¡
    renderAll();
</script>
</body>
</html>